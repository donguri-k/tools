<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="./css/main.css?20250128">
    <link rel="icon" href="/tools/favicon.ico">
    <title>donguri Arena Assist Tool</title>
  </head>
  <body>
    <header>
      <span><a href="/tools/">tools</a> &gt; arena-assist-tool</span>
      <style>
        ul {
          padding: 0;
        }
        #how-to-use div {
          margin-left: 12px;
        }
        h3 {
          text-decoration: underline;
        }
        h4 {
          text-decoration: underline dotted;
          margin-bottom: 4px;
        }
        dl.details {
          margin-left: 16px;
        }
        dl.details dd {
          margin-left: 16px;
        }
        dl.details dt {
          text-decoration: underline dotted;
        }
      </style>
    </header>
    <div class="wrapper">
      <h1>donguri Arena Assist Tool</h1>
      <div class="container">
        <div id="script">
          <h2>▼Script v1.2.2d</h2>
          <p>Userscript版</p>
          <a href="script/arena_assist_tool.user.js">https://donguri-k.github.io/tools/script/arena_assist_tool.user.js</a>
          <p>Bookmarklet版</p>
          <textarea id="textarea" readonly style="width:100%">javascript:((d,j,s)=>{s=d.createElement('script');s.src=j;d.body.appendChild(s);})(document,'https://donguri-k.github.io/tools/script/arena_assist_tool.user.js');</textarea>
          <p><a href="https://donguri-k.github.io/tools/script/arena_assist_tool.user.js">キャッシュ更新用</a> リンク先を開いてからリロード</p>
        </div>
        <div id="how-to-use">
          <h2>▼使い方</h2>
          <details>
            <summary>Userscript版</summary>
            <p>PCブラウザの場合は拡張機能Tampermonkeyをインストールし、上記のURLからインポート または scriptをコピーして保存する。</p>
            <p>スマートフォンの場合はUserscript対応のブラウザを使用するか、拡張機能対応のブラウザでPCと同様にTampermonkeyをインストール。</p>
          </details>
          <details>
            <summary>Bookmarklet版</summary>
            <p>上記のscriptをコピーし、名前を付けてブックマークに保存する。</p>
            <p>どんぐりチーム戦いのページで実行。</p>
          </details>
          <h2>▼説明・機能紹介</h2>
          <p>新仕様に対応中。更新が遅れる可能性あり</p>
          <div>
            <h3>[エリア情報更新/再取得] アリーナの制限とリーダーを表示、陣地の色と保有地域の更新</h3>
            <p>更新の場合は未取得のエリアと色が変わったエリアのみ取得。再取得は全てのエリアを読み込み直す。基本的にはエリア情報更新でよい。</p>
            <p>読み込みに失敗した場合は、しばらく時間をおいてから再試行すること。</p>
            <p>※短い間隔で再取得を連打しないよう。</p>
          </div>
          <div>
            <h3>[■装備] プリセット機能</h3>
            <h4>・[追加] 装備一覧を開き、各カテゴリの装備を選択し、名前を付けて登録。</h4>
            <p>登録した装備を選択すると、登録した装備に付け替える（未登録の箇所は登録されているもののみ付け替え）</p>
            <p>*既に装備中のアイテムは再装備しない設計となっており、プリセット選択時に装備情報を記録している。
              何らかの理由で装備の切り替えに問題が生じた場合は装備情報のリセットを実行。
            </p>
            <h4>・[装備登録] 各ランクごとにプリセットを登録可能。</h4>
            <p>登録しておくと、エリアに挑む前に登録した装備に変更（複数登録した場合はリストから選択）</p>
            <p>既に装備中の場合はスキップされる。</p>
            <p style="font-weight: bold;">自動参加にも必須。</p>
            <h4>・[バックアップ] インポート／エクスポートが可能。（JSON形式のテキスト）</h4>
            <p>直接編集して名前の変更や並べ替えも可能。</p>
            <p>書式が間違っているとうまく読み込めないので、編集する場合は十分注意すること。JSONとしてのヴァリデーションチェックしかしていないので、間違った情報が保存される場合もある。問題が起きた場合は空白にして保存すると初期化。</p>
          </div>
          <div>
            <h3>自動参加モード</h3>
            <p>メニュー内の[自動参加モード]から実行。自動的にアリーナに挑戦し、トークンを稼ぐことができる。</p>
            <P>※あらかじめ各ランクの装備を登録しておくこと。登録していないランクがあるとその分だけ攻撃可能なタイルが減り、成功率が低下する。</P>
            <p>チームカラーは大文字/小文字も正確に入力すること。</p>
            <p>終了ボタンで停止するほか、どんぐりが見つからない（ログインが無効になっている）場合など自動停止する。</p>
            <P>自動参加中はプログレスバーの更新を5分置きに変更。</P>
            <details>
              <summary>詳細な仕様</summary>
              <p>最初の試行から5分ごとに巡回し、予約の%範囲なら実行</p>
              <p>→ 成功時または攻撃可能なタイルが見つからない場合、その回は終了</p>
              <p>→ 次の回の予約（15%~35% / 65%~85%）</p>
              <p>以下、エラー時の処理 (ここに載っていない<span style="font-weight: bold">アリーナログの</span>エラーがあれば報告求む)</p>
              <dl class="details">
                <dt>20秒待機</dt>
                <dd>あなたのチームは動きを使い果たしました。しばらくお待ちください。</dd>
                <dd>ng&lt;&gt;too fast</dd>
                <dt>再取得</dt>
                <dd>このタイルは攻撃できません。範囲外です。</dd>
                <dt>停止</dt>
                <dd>最初にチームに参加する必要があります。</dd>
                <dd>どんぐりが見つかりませんでした。</dd>
                <dd>あなたのどんぐりが理解できませんでした。</dd>
                <dd>レベルが低すぎます。</dd>
                <dt>装備エラー</dt>
                <dd>武器と防具を装備しなければなりません。</dd>
                <dd>装備している防具と武器が力不足です。</dd>
                <dd>装備している防具と武器が強すぎます</dd>
                <dd>装備しているものは改造が多すぎます。改造の少ない他のものをお試しください</dd>
                <dt>首都に隣接していないタイル</dt>
                <dd>このタイルは攻撃できません。あなたのチームが首都を持つまで、どの首都にも隣接するタイルを主張することはできません。</dd>
                <dd>あなたのチームは首都を持っていないため、他のチームの首都に攻撃できません。</dd>
                <dt>自チームカラー及び隣接するタイル</dt>
                <dd>このタイルは攻撃できません。あなたのチームの制御領土に隣接していなければなりません。</dd>
                <dd>このタイルは攻撃できません。首都を奪取するには、隣接タイルを少なくとも3つ支配している必要があります。</dd>
                <dd>このタイルは攻撃できません。首都を奪取するには、隣接タイルを少なくとも2つ支配している必要があります。</dd>
                <dd>このタイルは攻撃できません。自分の首都は攻撃できません。</dd>
                <dt>首都に隣接するタイル</dt>
                <dd>このタイルは攻撃できません。混雑したマップでは、初期主張は正確に1つの首都に隣接していなければなりません。</dd>
                <dt>マップの端</dt>
                <dd>このタイルは攻撃できません。混雑したマップでは、初期主張はマップの端でなければなりません。</dd>
                <dt>停止</dt>
                <dd>[403] Forbidden</dd>
                <dt>20n秒待機 (最大600秒)</dt>
                <dd>[404] Not Found</dd>
                <dd>[500] Internal Server Error</dd>
                <dd>[502] Bad Gateway</dd>
                <dt>20秒待機</dt>
                <dd>その他のエラー</dd>
              </dl>
            </details>
          </div>
          
          <div>
            <h3>その他</h3>
            <p>表示の問題をいくつか改善。具体的には、画面外にはみ出る問題を解消、画面幅に合わせた縮小表示、<s>スマートフォンの一行あたり最大8マスまでに変更（デフォルト）。PCでも設定から変更可能。</s>1.2.0以降、セルの折り返しは廃止</p>
            <p>アリーナをページ内で開き、対戦ログも表示するようにした。</p>
            <p>セルをクリックで直接アリーナに挑戦するオプションを追加。エリア情報を開いた状態だと、情報取得も同時に行う。閉じた状態なら対戦のみ。</p>
            <p>セルを複数選択して連続で挑戦するモードを追加。[範囲攻撃]モードでセルをクリックすると赤枠になり、選択された状態になる。攻撃開始で対象のセルを1.5秒毎に攻撃。行動力切れとtoo fast及びどんぐりが見つからない場合は中断。</p>
            <p>中断後の再開時は、中断前に選択されていたセルが対象になる。（選択状態が解除されている場合はスキップ）</p>
          </div>
          <div>
            <h3>[設定]の説明</h3>
            <h4>・[保存]で設定を保存し、ページを再読み込み。[保存]を押すまでは設定は変更されず、保存もされていない。</h4>
            <p>[キャンセル]で設定を閉じ、変更した値をもとに戻す。</p>
            <p>×で閉じた場合は値はそのまま。</p>
            <h4>・単位について</h4>
            <p>px: 固定長のサイズ (pixel)</p>
            <p>%: 親要素に対する比率</p>
            <p>vw: 画面の表示サイズに対する横の比率 (ViewportWidth)</p>
            <p>vh 画面の表示サイズに対する縦の比率 (ViewportHeight)</p>
            <p>*これらは負の値も設定可能</p>
            <p>よく分からない場合はvw/vhを推奨。100が画面サイズいっぱいで、50なら半分。</p>
            <p>入力値がないものは初期設定が適用される。</p>
            <h4>・設定に問題が生じ、メニューが開けず元に戻せなくなった場合</h4>
            <p>どんぐりのページ（どこでもよい）で下記のscriptを実行。</p>
            <textarea readonly style="width:100%">javascript:(()=>{localStorage.removeItem('aat_settings');location.reload();})();</textarea>
            <p>設定が初期化され元の表示に戻る。（プリセットなどは削除されない）</p>
          </div>
        </div>
        <div id="to-do">
          <h2>▼ To Do</h2>
          <ul>
            <li>新仕様への対応 （優先度高）</li>
            <li>アリーナログを見やすくする?</li>
            <li>プログレスバーのマージン修正</li>
            <li>時間経過で自動更新に対応する？（需要があれば）</li>
            <li>その他 要望があれば順次</li>
            <li>見た目やUIに関しての改善点は多々あると思うので、フィードバックは歓迎</li>
            <li>その他バグ修正</li>
          </ul>
        </div>
        <div id="credit">
          <h2>▼お借りしたもの</h2>
          <ul>
            <li>
              <a href="https://kes.5ch.net/test/read.cgi/donguri/1735334537/680">アリーナ情報取得 | どんぐりチームスレ★2【チーム戦】- 680</a>
            </li>
            <li>
              <a href="https://kes.5ch.net/test/read.cgi/donguri/1735820145/780">プログレスバー取得 | どんぐりチームスレ★3【チーム戦】- 780</a>
            </li>
            <li>
              <a href="https://kes.5ch.net/test/read.cgi/donguri/1736064025/811">自動挑戦するscript | どんぐりチームスレ★4【チーム戦】- 811</a>
            </li>
          </ul>
        </div>
        <div id="update" style="font-size:13px">
          <h2>▼更新履歴</h2>
          <dl>
            <dt>v1.2.2d - 2025/08/25</dt>
            <dd>自動参加の狭いマップでの無限ループを解消</dd>
            <dd>リーダー奪取時にそのタイルを更新（チームカラーが設定されている場合）</dd>
            <dt>v1.2.2c - 2025/08/23</dt>
            <dd>登録装備が複数ある場合の自動参加の問題を修正</dd>
            <dd>自動装備のランダム機能を追加</dd>
            <dd>自動参加と対戦用の装備を別で登録できるようにした（任意）</dd>
            <dd>バックアップから編集した際に、登録装備から存在しないセットを削除</dd>
            <dt>v1.2.2b - 2025/08/22</dt>
            <dd>自動参加の装備変更処理で、r,c が逆になっていたのを修正</dd>
            <dt>v1.2.2a - 2025/08/22</dt>
            <dd>新ルールでの自動参加に対応</dd>
            <dt>v1.2.1c - 2025/08/10</dt>
            <dd>自動装備のON/OFF切り替え</dd>
            <dd>toolbarのボタン配置を変更</dd>
            <dt>v1.2.1b - 2025/08/09</dt>
            <dd>装備の登録数が0になったときに挑戦時にフリーズする不具合を修正</dd>
            <dt>v1.2.1a - 2025/08/09</dt>
            <dd>[装備登録機能] 装備変更を自動化 / 挑戦前に選択</dd>
            <dt>v1.2.0b - 2025/08/07</dt>
            <dd>首都の視認性を改善</dd>
            <dt>v1.2.0a - 2025/08/06</dt>
            <dd>首都の表示に対応</dd>
            <dd>スマートフォン向けに詳細/簡易表示の切替を可能にした</dd>
            <dd>一行当たりの最大セル数の設定と折り返しを廃止</dd>
            <dt>v1.1j - 2025/08/05</dt>
            <dd>自動参加時、自チームの首都がある場合にも対応</dd>
            <dt>v1.1i - 2025/08/05</dt>
            <dd>自動参加の首都問題に対応</dd>
            <dt>v1.1h - 2025/03/02</dt>
            <dd>カスタムカラーを設定可能にした</dd>
            <dt>v1.1g - 2025/02/08</dt>
            <dd>アリーナ情報の表示調整</dd>
            <dd>設定項目を追加</dd>
            <dd>- 一行あたりの最大セル数</dd>
            <dd>- 設定と装備の位置・高さ・横幅</dd>
            <dt>v1.1f - 2025/02/03</dt>
            <dd>アリーナ情報の左寄せがPCで中央寄せになる問題を修正</dd>
            <dt>v1.1e - 2025/02/03</dt>
            <dd>プリセット装備エラー時の処理を修正</dd>
            <dd>プリセット登録時に武器と防具を必須ではなくした（最低1つ選択で登録可能に）</dd>
            <dd>ソートの順序を変更</dd>
            <dd>設定項目を追加</dd>
            <dd>- toolbarの位置</dd>
            <dd>- アリーナログのスクロール位置（上・下）及びログ自体の位置・サイズ</dd>
            <dd>- アリーナ情報の位置とサイズ</dd>
            <dt>v1.1d - 2025/01/28</dt>
            <dd>toolbarのボタンサイズ変更</dd>
            <dd>ソート切り替えボタンの位置変更</dd>
            <dd>範囲攻撃の一括選択を実装</dd>
            <dd>- 中断・再開を追加</dd>
            <dd>- 攻撃中のセルの枠の色を緑に変更</dd>
            <dd>- ディレイを2秒→1.5秒に変更</dd>
            <dd>エリア情報取得の処理を変更</dd>
            <dd>メニュー</dd>
            <dt>v1.1c - 2025/01/24</dt>
            <dd>メニューのUI変更</dd>
            <dd>アリーナの情報取得をスキップして対戦するモードを追加</dd>
            <dd>セルを複数選択してまとめて挑戦するモードを追加</dd>
            <dd>自動参加の弾切れとtoo fastの際のリトライを4sから20sに変更</dd>
            <dd>自動参加のダイアログを開いた時の入力欄へのフォーカスを阻止</dd>
            <dd>自動参加のエラー処理を修正</dd>
            <dt>v1.1b - 2025/01/22</dt>
            <dd>自動参加の停止処理を修正（clearTimeoutの処理）</dd>
            <dd>自動参加のログを整形</dd>
            <dd>アイテムバッグの装備変更を捕捉（userscript版）</dd>
            <dd>対戦ログのスクロール位置の修正</dd>
            <dt>v1.1a - 2025/01/21</dt>
            <dd>一定時間ごとに自動参加する機能追加</dd>
            <dd>プリセットの装備処理実行中は他の装備を選択できないようにした</dd>
            <dd>装備完了時にプリセット名を表示</dd>
            <dd>アリーナ情報と対戦ログの位置変更（仮）</dd>
            <dt>v1.0c - 2025/01/20</dt>
            <dd>ソートボタン変更</dd>
            <dd>アリーナを開いた際のUIを変更。改造もページ内で済むように</dd>
            <dd>新規プリセットが即座にバックアップに反映されない問題を修正</dd>
            <dd>装備メニューのボタン位置微修正</dd>
            <dt>v1.0b - 2025/01/16</dt>
            <dd>装備メニューを枠外クリックで閉じるようにした</dd>
            <dd>無名のプリセットを保存できないようにした</dd>
            <dd>ボタンの位置等の微修正</dd>
            <dt>v1.0a - 2025/01/15</dt>
            <dd>装備プリセット機能追加</dd>
            <dd>名称変更</dd>
            <dt>v0.9d - 2025/01/07</dt>
            <dd>プログレスバー追加</dd>
            <dd>ボタンの位置変更</dd>
            <dd>アリーナログのスクロール初期位置を最下部に変更</dd>
            <dd>PC向けアリーナの表示幅変更</dd>
            <dt>v0.9c - 2025/01/06</dt>
            <dd>アリーナログのミスを修正</dd>
            <dd>ログの1行目に結果が表示されるようにした</dd>
            <dt>v0.9b - 2025/01/05</dt>
            <dd>グリッドの余白を削除。</dd>
            <dd>グリッド縮小のタイミングを変更</dd>
            <dt>v0.9a - 2025/01/05</dt>
            <dd>装備制限でのソートに対応</dd>
            <dd>対戦ログもダイアログで表示するようにした</dd>
            <dt>v0.8a - 2025/01/04</dt>
            <dd>未踏エリアの取得の問題を修正</dd>
            <dd>グリッドの縮小表示に対応</dd>
            <dd>アリーナを同一画面に表示するようにした（バトルログや強化/弱体はまだ）</dd>
            <dt>v0.7b - 2025/01/04</dt>
            <dd>陣地更新の問題を修正</dd>
            <dt>v0.7a - 2025/01/04</dt>
            <dd>初回リリース</dd>
          </dl>
        </div>
      </div>
    </div>
    <script>
      document.querySelector('#textarea').addEventListener('click',event=>{
        event.stopPropagation();
        const text = event.target.textContent;
        navigator.clipboard.writeText(text).then(alert('copy'));
      })
    </script>
  </body>
</html>
